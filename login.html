<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>تسجيل الدخول إلى MikroTik</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="login-container">
  <h2>تسجيل الدخول إلى MikroTik</h2>
  <form id="loginForm">
    <label>IP الجهاز:</label>
    <input type="text" id="router_ip" required placeholder="مثال: 192.168.88.1">

    <label>اسم المستخدم:</label>
    <input type="text" id="router_user" required placeholder="admin">

    <label>كلمة المرور:</label>
    <input type="password" id="router_pass" required>

    <button type="submit">تسجيل الدخول</button>
  </form>
  <p id="status"></p>
</div>

<script>
document.getElementById('loginForm').addEventListener('submit', async e => {
  e.preventDefault();

  const ip = document.getElementById('router_ip').value.trim();
  const user = document.getElementById('router_user').value.trim();
  const pass = document.getElementById('router_pass').value.trim();

  document.getElementById('status').textContent = "🔄 جاري التحقق من الاتصال...";

  // تجربة الدخول عبر HTTP login
  try {
    const loginUrl = `http://${ip}/login`;
    const formData = new URLSearchParams();
    formData.append('username', user);
    formData.append('password', pass);

    const response = await fetch(loginUrl, {method: 'POST', body: formData, credentials: 'include'});
    if (response.ok) {
      localStorage.setItem('mikrotik_ip', ip);
      localStorage.setItem('mikrotik_user', user);
      localStorage.setItem('mikrotik_pass', pass);
      document.getElementById('status').textContent = "✅ تم الاتصال بنجاح! جاري إضافة السكربت...";

      // محاولة إضافة السكربت التلقائي (HTTP request بسيط)
      const scriptContent = `:put "Script ready for user cards"`;
      const addScriptUrl = `http://${ip}/cmd`;
      await fetch(addScriptUrl, {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: `command=/system/script/add name="add_user_cards" source="${scriptContent}"`
      });

      alert("✅ تم إضافة السكربت إلى جهازك بنجاح!");
      window.location.href = "index.html";
    } else {
      document.getElementById('status').textContent = "❌ فشل تسجيل الدخول. تحقق من البيانات.";
    }
  } catch (e) {
    document.getElementById('status').textContent = "⚠️ لا يمكن الوصول إلى الجهاز عبر HTTP.";
  }
});
</script>
</body>
</html>
