<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ MikroTik</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="login-container">
  <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ MikroTik</h2>
  <form id="loginForm">
    <label>IP Ø§Ù„Ø¬Ù‡Ø§Ø²:</label>
    <input type="text" id="router_ip" required placeholder="Ù…Ø«Ø§Ù„: 192.168.88.1">

    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
    <input type="text" id="router_user" required placeholder="admin">

    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
    <input type="password" id="router_pass" required>

    <button type="submit">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
  </form>
  <p id="status"></p>
</div>

<script>
document.getElementById('loginForm').addEventListener('submit', async e => {
  e.preventDefault();

  const ip = document.getElementById('router_ip').value.trim();
  const user = document.getElementById('router_user').value.trim();
  const pass = document.getElementById('router_pass').value.trim();

  document.getElementById('status').textContent = "ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„...";

  // ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± HTTP login
  try {
    const loginUrl = `http://${ip}/login`;
    const formData = new URLSearchParams();
    formData.append('username', user);
    formData.append('password', pass);

    const response = await fetch(loginUrl, {method: 'POST', body: formData, credentials: 'include'});
    if (response.ok) {
      localStorage.setItem('mikrotik_ip', ip);
      localStorage.setItem('mikrotik_user', user);
      localStorage.setItem('mikrotik_pass', pass);
      document.getElementById('status').textContent = "âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³ÙƒØ±Ø¨Øª...";

      // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (HTTP request Ø¨Ø³ÙŠØ·)
      const scriptContent = `:put "Script ready for user cards"`;
      const addScriptUrl = `http://${ip}/cmd`;
      await fetch(addScriptUrl, {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: `command=/system/script/add name="add_user_cards" source="${scriptContent}"`
      });

      alert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø¥Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ Ø¨Ù†Ø¬Ø§Ø­!");
      window.location.href = "index.html";
    } else {
      document.getElementById('status').textContent = "âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
    }
  } catch (e) {
    document.getElementById('status').textContent = "âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¹Ø¨Ø± HTTP.";
  }
});
</script>
</body>
</html>
